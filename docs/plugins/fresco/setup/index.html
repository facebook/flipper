<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.3">
<link rel="search" type="application/opensearchdescription+xml" title="Flipper" href="/opensearch.xml">
<script src="https://buttons.github.io/buttons.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
<script src="/js/code-blocks-buttons.js"></script>
<script src="/js/google-analytics.js"></script><title data-react-helmet="true"></title><link rel="stylesheet" href="/assets/css/styles.6fba2a7d.css">
<link rel="preload" href="/assets/js/runtime~main.d0b5e3de.js" as="script">
<link rel="preload" href="/assets/js/main.cb2a7a60.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script>
<div style="display: none; text-align: center; background-color: white; color: black;" id="internaldocs-banner"></div><div id="__docusaurus">
<div class="main-wrapper mdx-wrapper mdx-page embedded"><main><p>Currently, the images plugin only supports <a href="https://frescolib.org/" target="_blank" rel="noopener noreferrer">Fresco</a> for Android as backend, but just like the network plugin, support for other image loading libraries
could easily be added. Send us a PR!</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="fresco-and-android"></a>Fresco and Android<a class="hash-link" href="#fresco-and-android" title="Direct link to heading">#</a></h2><p>The Fresco images plugin is shipped as a separate Maven artifact:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly groovy"><pre tabindex="0" class="prism-code language-groovy codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">dependencies {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  debugImplementation &#x27;com.facebook.flipper:flipper-fresco-plugin:0.30.1&#x27;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>After including the plugin in your dependencies, you can add it to the
client:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">import com.facebook.flipper.plugins.fresco.FrescoFlipperPlugin;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">client.addPlugin(new FrescoFlipperPlugin());</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The <code>FrescoFlipperPlugin</code> constructor offers a whole lot of configuration options which
can be useful if you have an advanced setup of Fresco in your application:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">FrescoFlipperPlugin(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      DebugImageTracker imageTracker,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      PlatformBitmapFactory bitmapFactory,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      @Nullable FlipperObjectHelper flipperObjectHelper,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      DebugMemoryManager memoryManager,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      FlipperPerfLogger perfLogger,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      @Nullable FrescoFlipperDebugPrefHelper debugPrefHelper,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      @Nullable CloseableReferenceLeakTracker closeableReferenceLeakTracker) { ... }</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="leak-tracking"></a>Leak Tracking<a class="hash-link" href="#leak-tracking" title="Direct link to heading">#</a></h3><p>The Flipper plugin can help you track down <code>CloseableReferences</code> who have not had
<code>close()</code> called on them. This can have a negative impact on the performance of
your application.</p><p>To enable this functionality, you need to create a <code>CloseableReferenceLeakTracker</code>
and set it in both your <code>ImagePipelineConfig</code> for Fresco and the <code>FrescoPluginPlugin</code>
on creation.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">import com.facebook.imagepipeline.debug.FlipperCloseableReferenceLeakTracker;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// ...</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">FlipperCloseableReferenceLeakTracker leakTracker = new FlipperCloseableReferenceLeakTracker();</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">new ImagePipelineConfig.Builder()</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // ...</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    .setCloseableReferenceLeakTracker(leakTracker)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    .build();</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">client.addPlugin(new FrescoFlipperPlugin(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    new FlipperImageTracker(),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Fresco.getImagePipelineFactory().getPlatformBitmapFactory(),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    null,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    new NoOpDebugMemoryManager(),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    new NoOpFlipperPerfLogger(),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    null,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    leakTracker));</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="attribution"></a>Attribution<a class="hash-link" href="#attribution" title="Direct link to heading">#</a></h3><p>In order to annotate images with the context they are used in, you have to set a
caller context when loading the image. This can be any object, so for the simplest
case, a String will suffice.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">String callerContext = &quot;my_feature&quot;;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// For DraweeViews:</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">draweeView.setImageURI(uri, callerContext);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// For prefetching:</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ImagePipeline imagePipeline = Fresco.getImagePipeline();</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">imagePipeline.prefetchToDiskCache(imageRequest, callerContext);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// For manually fetching an image:</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">DataSource&lt;CloseableReference&lt;CloseableImage&gt;&gt;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    dataSource = imagePipeline.fetchDecodedImage(imageRequest, callerContext);</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>If a caller context is supplied, the image will be properly attributed in the
Flipper image plugin.</p></main></div></div>
<script src="/assets/js/runtime~main.d0b5e3de.js"></script>
<script src="/assets/js/main.cb2a7a60.js"></script>
</body>
</html>