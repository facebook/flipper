<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Secure Communication · Flipper</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="Below is an outline of how a connection is established between an app with our SDK integrated, and the desktop app. This all goes on behind the scenes inside the mobile SDK, so users shouldn&#x27;t need to worry about it."/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Secure Communication · Flipper"/><meta property="og:type" content="website"/><meta property="og:url" content="https://fbflipper.com//index.html"/><meta property="og:description" content="Below is an outline of how a connection is established between an app with our SDK integrated, and the desktop app. This all goes on behind the scenes inside the mobile SDK, so users shouldn&#x27;t need to worry about it."/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/img/icon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/code-blocks-buttons.js"></script><script type="text/javascript" src="/js/google-analytics.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/icon.png" alt="Flipper"/><h2 class="headerTitleWithLogo">Flipper</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/docs/features/index.html" target="_self">Features</a></li><li class=""><a href="/docs/getting-started/index.html" target="_self">Setup</a></li><li class="siteNavGroupActive"><a href="/docs/extending/index.html" target="_self">Extending</a></li><li class=""><a href="https://github.com/facebook/flipper" target="_self">GitHub</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Other Platforms</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Extending Flipper</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/extending/index.html">Clients and Plugins</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Tutorial</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/tutorial/intro.html">Intro</a></li><li class="navListItem"><a class="navItem" href="/docs/tutorial/ios.html">Building an iOS Plugin</a></li><li class="navListItem"><a class="navItem" href="/docs/tutorial/android.html">Building an Android Plugin</a></li><li class="navListItem"><a class="navItem" href="/docs/tutorial/react-native.html">Building a React Native Plugin</a></li><li class="navListItem"><a class="navItem" href="/docs/tutorial/js-setup.html">Building a desktop plugin</a></li><li class="navListItem"><a class="navItem" href="/docs/tutorial/js-table.html">Showing a table</a></li><li class="navListItem"><a class="navItem" href="/docs/tutorial/js-custom.html">Custom UI</a></li><li class="navListItem"><a class="navItem" href="/docs/tutorial/js-publishing.html">Publishing</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Plugin Development</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/extending/js-setup.html">JavaScript Plugin Definition</a></li><li class="navListItem"><a class="navItem" href="/docs/extending/js-plugin-api.html">JavaScript Plugin API</a></li><li class="navListItem"><a class="navItem" href="/docs/extending/create-table-plugin.html">Create Table Plugin</a></li><li class="navListItem"><a class="navItem" href="/docs/extending/ui-components.html">UI Components</a></li><li class="navListItem"><a class="navItem" href="/docs/extending/styling-components.html">Styling Components</a></li><li class="navListItem"><a class="navItem" href="/docs/extending/search-and-filter.html">Searching and Filtering</a></li><li class="navListItem"><a class="navItem" href="/docs/extending/create-plugin.html">Client Plugin API</a></li><li class="navListItem"><a class="navItem" href="/docs/extending/client-plugin-lifecycle.html">Client Plugin Lifecycle</a></li><li class="navListItem"><a class="navItem" href="/docs/extending/send-data.html">Providing Data to Plugins</a></li><li class="navListItem"><a class="navItem" href="/docs/extending/error-handling.html">Error Handling</a></li><li class="navListItem"><a class="navItem" href="/docs/extending/testing.html">Testing</a></li><li class="navListItem"><a class="navItem" href="/docs/extending/debugging.html">Debugging</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Other Platforms</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/extending/new-clients.html">Implementing a Flipper Client</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/extending/establishing-a-connection.html">Secure Communication</a></li><li class="navListItem"><a class="navItem" href="/docs/extending/supporting-layout.html">Implementing Layout Inspection</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Internals</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/extending/arch.html">Architecture</a></li><li class="navListItem"><a class="navItem" href="/docs/extending/layout-inspector.html">Extending Layout Inspector</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/facebook/flipper/blob/master/docs/extending/establishing-a-connection.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 id="__docusaurus" class="postHeaderTitle">Secure Communication</h1></header><article><div><span><p>Below is an outline of how a connection is established between an app with our SDK integrated, and the desktop app. This all goes on behind the scenes inside the mobile SDK, so users shouldn't need to worry about it.</p>
<p>The connection process is a little more involved than you might expect, to stop Flipper clients on mobile apps from connecting to any server that happens to be running on localhost and potentially leaking information from your app.</p>
<h2><a class="anchor" aria-hidden="true" id="transport-protocol"></a><a href="#transport-protocol" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Transport Protocol</h2>
<p>Flipper uses <a href="http://rsocket.io/">RSocket</a> to communicate between the desktop and mobile apps. RSocket allows for bi-directional communication.</p>
<h2><a class="anchor" aria-hidden="true" id="client-server-relationship"></a><a href="#client-server-relationship" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Client-Server relationship</h2>
<p>When the desktop app starts up, it opens a secure socket on port 8088.
The Flipper client will continually attempt to connect to this port on localhost to establish a connection with the desktop app.</p>
<h2><a class="anchor" aria-hidden="true" id="certificate-exchange"></a><a href="#certificate-exchange" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Certificate Exchange</h2>
<p>To avoid mobile apps from connecting to untrusted ports on localhost, a Flipper client should only connect to servers that have a valid, trusted TLS certificate.
In order for the mobile app to know which certificates it can trust, it conducts a certificate exchange with the desktop app before it can make its first secure connection.</p>
<p>This is achieved through the following steps:</p>
<ul>
<li>Desktop app starts an insecure server on port 8089.</li>
<li>Mobile app connects to localhost:8089 and sends a Certificate Signing Request to the desktop app.</li>
<li>Desktop app uses it's private key (this is generated once and stored in ~/.flipper) to sign a client certificate for the mobile app.</li>
<li>The desktop uses ADB (for Android), or the mounted file system (for iOS simulators) to write the following files to the mobile app's private data partition
<ul>
<li>Server certificate that the mobile app can now trust.</li>
<li>Client certificate for the mobile app to use going forward.</li>
</ul></li>
<li>Now the mobile app knows which server certificate it can trust, and can connect to the secure server.</li>
</ul>
<p>This allows the mobile app to trust a certificate if and only if, it is stored inside its internal data partition. Typically it's only possible to write there with physical access to the device (i.e. through ADB or a mounted simulator).</p>
<p>To get the desktop app to generate a client certificate for your client, and then deploy it, go through the following steps:</p>
<p>Use an RSocket client to connect (insecurely) to the following URL:</p>
<p>(Parameters are defined in <a href="new-clients">Implementing a Flipper Client</a>)</p>
<pre><code class="hljs"><span class="hljs-symbol">localhost:</span><span class="hljs-number">8089</span>/sonar?os={OS}
                     <span class="hljs-variable">&amp;device</span>={DEVICE}
                     <span class="hljs-variable">&amp;app</span>={APP}
                     <span class="hljs-variable">&amp;sdk_version</span>={SDK_VERSION}
</code></pre>
<p>On that connection, send the following payload:</p>
<pre><code class="hljs">Request = {
  <span class="hljs-string">"method"</span>: <span class="hljs-string">"signCertificate"</span>,
  <span class="hljs-string">"csr"</span>: <span class="hljs-built_in">string</span>,
  <span class="hljs-string">"destination"</span>: <span class="hljs-built_in">string</span>
}
</code></pre>
<p>Where <code>csr</code> is a Certificate Signing Request the client has generated, and <code>destination</code> identifies a location accessible to both the client and Flipper desktop, where the certificate should be placed.</p>
<p>The Subject Common Name (CN=...) must be included in the CSR, and your <code>CertificateProvider</code> implementation in Flipper may use this in combination with the <code>destination</code> to determine where to put the certificate.</p>
<p>This will ask Flipper desktop to generate a client certificate, using the CSR provided, and put it into the specified <code>destination</code>.</p>
<p>Depending on the client, <code>destination</code> can have a different meaning. A basic example would be a file path, that both the desktop and the client have access to. With this Flipper desktop could write the certificate to that path. A more involved example is that of the Android Client, where destination specifies a relative path inside an app container. And the Subject Common Name determines which app container. Together these two pieces of information form an absolute file path inside an android device.</p>
<p>For Flipper desktop to work with a given Client type, it needs to be modified to know how to correctly interpret the <code>destination</code> argument, and deploy certificates to it. You can see the current implementations in <a href="https://github.com/facebook/flipper/blob/master/desktop/src/utils/CertificateProvider.tsx">CertificateProvider.tsx</a>.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/extending/new-clients.html"><span class="arrow-prev">← </span><span>Implementing a Flipper Client</span></a><a class="docs-next button" href="/docs/extending/supporting-layout.html"><span>Implementing Layout Inspection</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#transport-protocol">Transport Protocol</a></li><li><a href="#client-server-relationship">Client-Server relationship</a></li><li><a href="#certificate-exchange">Certificate Exchange</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/mascot.png" alt="Flipper mascot" title="I&#x27;m a dolphin not a whale!" width="66"/></a><div><h5>Docs</h5><a href="/docs/getting-started.html">Getting Started</a><a href="/docs/extending/js-setup.html">Creating Plugins</a></div><div><h5>Plugins</h5><a href="/docs/features/logs-plugin.html">Log Viewer</a><a href="/docs/features/layout-plugin.html">Layout Inspector</a><a href="/docs/features/network-plugin.html">Network Inspector</a></div><div><h5>More</h5><a href="https://twitter.com/flipper_fb">Twitter</a><a href="https://github.com/facebook/flipper">GitHub</a><a class="github-button" href="https://github.com/facebook/flipper" data-icon="octicon-star" data-count-href="/facebook/flipper/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><a href="https://code.facebook.com/projects/" target="_blank" class="fbOpenSource"><img src="/img/oss_logo.png" alt="Facebook Open Source" width="170" height="45"/></a><section class="copyright">Copyright © 2020 Facebook</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '2df980e7ffc95c19552790f7cad32666',
                indexName: 'fbflipper',
                inputSelector: '#search_input_react',
                algoliaOptions: {"hitsPerPage":5}
              });
            </script></body></html>