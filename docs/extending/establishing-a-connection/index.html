<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.72">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Flipper Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Flipper Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Flipper" href="/opensearch.xml">
<script src="https://buttons.github.io/buttons.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
<script src="/js/code-blocks-buttons.js"></script>
<script src="/js/google-analytics.js"></script><title data-react-helmet="true">Secure Communication | Flipper</title><meta data-react-helmet="true" property="og:url" content="https://fbflipper.com//docs/extending/establishing-a-connection"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Secure Communication | Flipper"><meta data-react-helmet="true" name="description" content="Below is an outline of how a connection is established between an app with our SDK integrated, and the desktop app. This all goes on behind the scenes inside the mobile SDK, so users shouldn&#x27;t need to worry about it."><meta data-react-helmet="true" property="og:description" content="Below is an outline of how a connection is established between an app with our SDK integrated, and the desktop app. This all goes on behind the scenes inside the mobile SDK, so users shouldn&#x27;t need to worry about it."><link data-react-helmet="true" rel="shortcut icon" href="/img/icon.png"><link data-react-helmet="true" rel="canonical" href="https://fbflipper.com//docs/extending/establishing-a-connection"><link data-react-helmet="true" rel="alternate" href="https://fbflipper.com//docs/extending/establishing-a-connection" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://fbflipper.com//docs/extending/establishing-a-connection" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.e25aa0ce.css">
<link rel="preload" href="/assets/js/styles.f2883f2f.js" as="script">
<link rel="preload" href="/assets/js/runtime~main.8b44d1a8.js" as="script">
<link rel="preload" href="/assets/js/main.06104b48.js" as="script">
<link rel="preload" href="/assets/js/1.3253a667.js" as="script">
<link rel="preload" href="/assets/js/2.e90dde1c.js" as="script">
<link rel="preload" href="/assets/js/72.4ffbfb98.js" as="script">
<link rel="preload" href="/assets/js/75.1db45689.js" as="script">
<link rel="preload" href="/assets/js/935f2afb.a672d555.js" as="script">
<link rel="preload" href="/assets/js/17896441.d01c4db3.js" as="script">
<link rel="preload" href="/assets/js/e1925c59.f28cdebc.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script>
<div style="display: none; text-align: center; background-color: white; color: black;" id="internaldocs-banner"></div><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/icon.png" alt="Flipper Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/icon.png" alt="Flipper Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Flipper</strong></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/features/index">Features</a><a class="navbar__item navbar__link" href="/docs/getting-started/index">Setup</a><a class="navbar__item navbar__link" href="/docs/tutorial/intro">Creating Plugins</a><a class="navbar__item navbar__link" href="/docs/internals/index">Under the Hood</a><a href="https://github.com/facebook/flipper" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar-github-link" aria-label="GitHub repository"></a><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/icon.png" alt="Flipper Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/icon.png" alt="Flipper Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Flipper</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/features/index">Features</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/getting-started/index">Setup</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/tutorial/intro">Creating Plugins</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/internals/index">Under the Hood</a></li><li class="menu__list-item"><a href="https://github.com/facebook/flipper" target="_blank" rel="noopener noreferrer" class="menu__link navbar-github-link" aria-label="GitHub repository"></a></li></ul></div></div></div></nav><div class="main-wrapper main-docs-wrapper"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Getting Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/index">Desktop App</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Adding Flipper to your app</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/getting-started/android-native">Android with Gradle</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/getting-started/ios-native">Generic iOS apps</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">React Native</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/getting-started/react-native">Automatic Setup</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/getting-started/react-native-android">Manual Android Setup</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/getting-started/react-native-ios">Manual iOS Setup</a></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/troubleshooting">Troubleshooting Issues</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">Other Platforms</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/extending/new-clients">Implementing a Flipper Client</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/extending/establishing-a-connection">Secure Communication</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/extending/supporting-layout">Implementing Layout Inspection</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Plugin Setup</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/setup/layout-plugin">Layout Inspector</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/setup/navigation-plugin">Navigation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/setup/network-plugin">Network</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/setup/databases-plugin">Databases</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/setup/images-plugin">Images</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/setup/sandbox-plugin">Sandbox</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/setup/shared-preferences-plugin">Shared Preferences</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/setup/leak-canary-plugin">LeakCanary</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/setup/leak-canary-2-plugin">LeakCanary 2</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/setup/crash-reporter-plugin">Crash Reporter</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Advanced</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/custom-ports">Using different ports</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/stetho">Stetho Guidance</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">Secure Communication</h1></header><div class="markdown"><p>Below is an outline of how a connection is established between an app with our SDK integrated, and the desktop app. This all goes on behind the scenes inside the mobile SDK, so users shouldn&#x27;t need to worry about it.</p><p>The connection process is a little more involved than you might expect, to stop Flipper clients on mobile apps from connecting to any server that happens to be running on localhost and potentially leaking information from your app.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="transport-protocol"></a>Transport Protocol<a class="hash-link" href="#transport-protocol" title="Direct link to heading">#</a></h2><p>Flipper uses <a href="http://rsocket.io/" target="_blank" rel="noopener noreferrer">RSocket</a> to communicate between the desktop and mobile apps. RSocket allows for bi-directional communication.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="client-server-relationship"></a>Client-Server relationship<a class="hash-link" href="#client-server-relationship" title="Direct link to heading">#</a></h2><p>When the desktop app starts up, it opens a secure socket on port 8088.
The Flipper client will continually attempt to connect to this port on localhost to establish a connection with the desktop app.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="certificate-exchange"></a>Certificate Exchange<a class="hash-link" href="#certificate-exchange" title="Direct link to heading">#</a></h2><p>To avoid mobile apps from connecting to untrusted ports on localhost, a Flipper client should only connect to servers that have a valid, trusted TLS certificate.
In order for the mobile app to know which certificates it can trust, it conducts a certificate exchange with the desktop app before it can make its first secure connection.</p><p>This is achieved through the following steps:</p><ul><li>Desktop app starts an insecure server on port 8089.</li><li>Mobile app connects to localhost:8089 and sends a Certificate Signing Request to the desktop app.</li><li>Desktop app uses it&#x27;s private key (this is generated once and stored in ~/.flipper) to sign a client certificate for the mobile app.</li><li>Along with the Certificate Signing Request, mobile app also lets the desktop app know which certificate exchange medium to use.</li><li>If the chosen Certificate Exchange Medium is FS_ACCESS, the desktop uses ADB (for Android), or the mounted file system (for iOS simulators) to write the following files to the mobile app&#x27;s private data partition<ul><li>Server certificate that the mobile app can now trust.</li><li>Client certificate for the mobile app to use going forward.</li></ul></li><li>If the chosen Certificate Exchange Medium is WWW, the desktop app will use your implementation of Certificate Uploader to upload the certificates.<ul><li>Once uploaded the desktop app will reply back with the device id, which can be used by Certificate Provider on the client side to fetch those certificates.</li></ul></li><li>Now the mobile app knows which server certificate it can trust, and can connect to the secure server.</li></ul><p>This allows the mobile app to trust a certificate if and only if, it is stored inside its internal data partition. Typically it&#x27;s only possible to write there with physical access to the device (i.e. through ADB or a mounted simulator).</p><p>To get the desktop app to generate a client certificate for your client, and then deploy it, go through the following steps:</p><p>Use an RSocket client to connect (insecurely) to the following URL:</p><p>(Parameters are defined in <a href="/docs/extending/new-clients">Implementing a Flipper Client</a>)</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">localhost:8089/sonar?os={OS}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                     &amp;device={DEVICE}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                     &amp;app={APP}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                     &amp;sdk_version={SDK_VERSION}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                     &amp;medium={CERTIFICATE_EXCHANGE_MEDIUM}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>On that connection, send the following payload:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly js"><div tabindex="0" class="prism-code language-js codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token maybe-class-name">Request</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;method&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;signCertificate&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;csr&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;destination&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;medium&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> int</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Where <code>csr</code> is a Certificate Signing Request the client has generated, and <code>destination</code> identifies a location accessible to both the client and Flipper desktop, where the certificate should be placed.</p><p>The Subject Common Name (CN=...) must be included in the CSR, and your <code>CertificateProvider</code> implementation in Flipper may use this in combination with the <code>destination</code> to determine where to put the certificate.</p><p>This will ask Flipper desktop to generate a client certificate, using the CSR provided, and put it into the specified <code>destination</code>.</p><p>Depending on the client, <code>destination</code> can have a different meaning. A basic example would be a file path, that both the desktop and the client have access to. With this Flipper desktop could write the certificate to that path. A more involved example is that of the Android Client, where destination specifies a relative path inside an app container. And the Subject Common Name determines which app container. Together these two pieces of information form an absolute file path inside an android device.</p><p>For Flipper desktop to work with a given Client type, it needs to be modified to know how to correctly interpret the <code>destination</code> argument, and deploy certificates to it.</p><p><code>destination</code> field may not be relevant if your <code>medium</code> value is more than 1. <code>medium=1</code>(default) means Flipper should do certificate exchange by directly putting certificates at <code>destination</code> in the sandbox of the app. <code>medium=2</code> means Flipper will use Certificate Uploader and Provider to upload certificates and download it on the client side respectively.</p><p>You can see the current implementations in <a href="https://github.com/facebook/flipper/blob/master/desktop/app/src/utils/CertificateProvider.tsx" target="_blank" rel="noopener noreferrer">CertificateProvider.tsx</a>.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/facebook/flipper/blob/master/website/../docs/extending/establishing-a-connection.mdx" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/extending/new-clients"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Implementing a Flipper Client</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/extending/supporting-layout"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Implementing Layout Inspection »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#transport-protocol" class="table-of-contents__link">Transport Protocol</a></li><li><a href="#client-server-relationship" class="table-of-contents__link">Client-Server relationship</a></li><li><a href="#certificate-exchange" class="table-of-contents__link">Certificate Exchange</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Learn</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started/index">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/tutorial/intro">Plugin Creation Tutorial</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Plugins</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/features/index">Core Plugins</a></li><li class="footer__item"><a href="https://www.npmjs.com/search?q=keywords:flipper-plugin" target="_blank" rel="noopener noreferrer" class="footer__link-item">Community Plugins</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Legal</h4><ul class="footer__items"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy</a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/flipper_fb" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li><li class="footer__item"><a href="https://github.com/facebook/flipper" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/img/mascot.png" alt="Flipper Mascot" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="/img/mascot.png" alt="Flipper Mascot" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></div><div class="footer__copyright">Copyright © 2021 Facebook</div></div></div></footer></div>
<script src="/assets/js/styles.f2883f2f.js"></script>
<script src="/assets/js/runtime~main.8b44d1a8.js"></script>
<script src="/assets/js/main.06104b48.js"></script>
<script src="/assets/js/1.3253a667.js"></script>
<script src="/assets/js/2.e90dde1c.js"></script>
<script src="/assets/js/72.4ffbfb98.js"></script>
<script src="/assets/js/75.1db45689.js"></script>
<script src="/assets/js/935f2afb.a672d555.js"></script>
<script src="/assets/js/17896441.d01c4db3.js"></script>
<script src="/assets/js/e1925c59.f28cdebc.js"></script>
</body>
</html>