<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.56">
<link rel="search" type="application/opensearchdescription+xml" title="Flipper" href="/opensearch.xml">
<script src="https://buttons.github.io/buttons.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
<script src="/js/code-blocks-buttons.js"></script>
<script src="/js/google-analytics.js"></script><title data-react-helmet="true">Implementing Layout Inspection | Flipper</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Implementing Layout Inspection | Flipper"><meta data-react-helmet="true" name="description" content="To enable the Flipper layout inspector on a new platform, just implement a client plugin with id Inspector which implements the following interface:"><meta data-react-helmet="true" property="og:description" content="To enable the Flipper layout inspector on a new platform, just implement a client plugin with id Inspector which implements the following interface:"><meta data-react-helmet="true" property="og:url" content="https://fbflipper.com//docs/extending/supporting-layout"><link data-react-helmet="true" rel="shortcut icon" href="/img/icon.png"><link data-react-helmet="true" rel="canonical" href="https://fbflipper.com//docs/extending/supporting-layout"><link rel="stylesheet" href="/styles.a01bac9f.css">
<link rel="preload" href="/styles.24aaa79f.js" as="script">
<link rel="preload" href="/runtime~main.f6c5a1a3.js" as="script">
<link rel="preload" href="/main.9115e7e0.js" as="script">
<link rel="preload" href="/1.0e39a8dc.js" as="script">
<link rel="preload" href="/2.580ff063.js" as="script">
<link rel="preload" href="/70.e3afd952.js" as="script">
<link rel="preload" href="/20ac7829.82c23b79.js" as="script">
<link rel="preload" href="/2527d735.0a52814b.js" as="script">
</head>
<body>
<div style="display: none; text-align: center; background-color: white; color: black;" id="internaldocs-banner"></div><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/icon.png" alt="Flipper Logo"><strong class="navbar__title">Flipper</strong></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/features/index">Features</a><a class="navbar__item navbar__link" href="/docs/getting-started/index">Setup</a><a class="navbar__item navbar__link" href="/docs/extending/index">Extending</a><a href="https://github.com/facebook/flipper" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="navbar__search"><div class="searchWrapper_-F3-"><span aria-label="expand searchbar" role="button" class="searchIconButton_1Dnz" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Search" aria-label="Search" class="navbar__search-input searchInput_2eto"></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/icon.png" alt="Flipper Logo"><strong class="navbar__title">Flipper</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/features/index">Features</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/getting-started/index">Setup</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/extending/index">Extending</a></li><li class="menu__list-item"><a href="https://github.com/facebook/flipper" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp"><div class="sidebar_1kLs"><div class="menu menu--responsive menu_w2sC"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Extending Flipper</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/extending/index">Clients and Plugins</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Tutorial</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorial/intro">Intro</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorial/ios">Building an iOS Plugin</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorial/android">Building an Android Plugin</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorial/react-native">Building a React Native Plugin</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorial/js-setup">Building a Desktop Plugin</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorial/js-table">Showing a table</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorial/js-custom">Custom UI</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tutorial/js-publishing">Publishing</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Plugin Development</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/extending/js-setup">Desktop Plugin Development</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/extending/js-plugin-api">Desktop Plugin API</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/extending/create-table-plugin">Create Table Plugin</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/extending/ui-components">UI Components</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/extending/styling-components">Styling Components</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/extending/search-and-filter">Searching and Filtering</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/extending/create-plugin">Client Plugin API</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/extending/client-plugin-lifecycle">Client Plugin Lifecycle</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/extending/send-data">Providing Data to Plugins</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/extending/error-handling">Error Handling</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/extending/testing">Testing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/extending/debugging">Debugging</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Other Platforms</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/extending/new-clients">Implementing a Flipper Client</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/extending/establishing-a-connection">Secure Communication</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/extending/supporting-layout">Implementing Layout Inspection</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Internals</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/extending/arch">Architecture</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/extending/layout-inspector">Extending Layout Inspector</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/extending/testing-rn">Testing RN Changes</a></li></ul></li></ul></div></div></div><main class="docMainContainer_FFX1"><div class="container padding-vert--lg docItemWrapper_1cc7"><div class="row"><div class="col docItemCol_2GOA"><div class="docItemContainer_2cwg"><article><header><h1 class="docTitle_1vWb">Implementing Layout Inspection</h1></header><div class="markdown"><p>To enable the Flipper layout inspector on a new platform, just implement a client plugin with id <code>Inspector</code> which implements the following interface:</p><p>Note that we&#x27;re using <a href="https://flow.org/en/docs/types/objects/" target="_blank" rel="noopener noreferrer">Flow</a> syntax to specify this JSON API.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="node"></a>Node<a aria-hidden="true" tabindex="-1" class="hash-link" href="#node" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">type NodeId = string;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">type InspectorValue = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  __type__: &#x27;auto&#x27; | &#x27;text&#x27; | &#x27;number&#x27; | &#x27;boolean&#x27; | &#x27;enum&#x27; | &#x27;color&#x27;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  __mutable__: boolean,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  value: number | string | boolean,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">};</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">type Node = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  id: NodeId,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  name: string,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  data: ?{string: Object},</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  children: Array&lt;NodeId&gt;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  attributes: ?Array&lt;{name: string, value: string}&gt;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  decoration: ?string,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">};</span></div></div></div></div></div><p>Node is the core data type of the layout inspector. The Flipper desktop plugin visualizes a tree of nodes with associated data and attributes. Any UI or data model which can be modeled as a tree of nodes can be inspected using the layout inspector. Data associated with the nodes can also be edited.</p><p><code>id</code> is a stable globally unique node identifier.</p><p><code>name</code> is the user facing identifier for this node. It does not need to be unique. Typically the class name of the node is used as the node&#x27;s name.</p><p><code>data</code> is a set of named JSON objects representing data associated with the node. This data will be rendered as immutable by default, to the user of the plugin but can be made mutable by wrapping any value in a InspectorValue with the <code>__mutable__</code> attribute set to true.</p><p>InspectorValue can also be used to change the parsed type of the value, such as parsing a number as a color to show the value in a color picker.</p><p><code>children</code> is a list of identifiers pointing to children of this node. This is a list of identifiers instead of a list of nodes to allow nodes to be lazily fetched and instantiated.</p><p><code>attributes</code> is a list of key:value pairs which are displayed alongside the name in the layout inspector.</p><p><code>decoration</code> is a string identifying the optional icon used to decorate a node in the layout inspector. Adding new decoration options requires adding an icon file to the Sonar desktop app. Currently componentkit and litho decorations are supported.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="plugin-interface"></a>Plugin Interface<a aria-hidden="true" tabindex="-1" class="hash-link" href="#plugin-interface" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">interface ClientLayoutPlugin {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Node getRoot();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  GetNodesResponse getNodes({ids: Array&lt;NodeId&gt;});</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  GetAllNodesResponse getAllNodes();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  void setData({id: NodeId, path: Array&lt;string&gt;, value: any});</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  void setHighlighted({id: ?NodeId});</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  void setSearchActive({active: boolean});</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  GetSearchResultsResponse getSearchResults({query: string});</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">};</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">interface DesktopLayoutPlugin {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  void invalidate({id: NodeId});</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  void select({path: Array&lt;NodeId&gt;});</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">};</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">type GetNodesResponse = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  elements: Array&lt;Node&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">};</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">type GetAllNodesResponse = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  elements: Array&lt;Node&gt;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  rootElement: NodeId</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">};</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">type GetSearchResultsResponse = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  results: ?SearchResultNode,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  query: string</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">};</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">type SearchResultNode = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  id: NodeId,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  isMatch: boolean,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  element: Node,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  children: ?Array&lt;SearchResultNode&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">type NodeId = string;</span></div></div></div></div></div><p><strong>getRoot</strong>: Return the root node of your hierarchy. This is the entry point of Flipper&#x27;s traversal of your layout.</p><p><strong>getNodes</strong>: Map a set of NodeIds to their corresponding nodes. This call is used to among other things query the children of a node.</p><p><strong>getAllNodes</strong>: Similar to getNodes, this should return all nodes in the current layout tree. Ordinarily, nodes are requested lazily, however this exists for taking snapshots of the current state.</p><p><strong>setData</strong>: Set the data of an mutable data object returned as part of the data field of a node. The id parameter identifies the node, the path parameter is a index path into an object, e.g. <code>[&#x27;bounds&#x27;, &#x27;left&#x27;]</code> and the value parameter is a value of appropriate type to be used as an override.</p><p><strong>setHighlighted</strong>: Mark a node as highlighted. It is expected that implementations adds a colored overlay to the node identified by id on screen, so that as the user browses the layout tree in flipper, they can easily see on the the client display the nodes they are interacting with. Passing a null id parameter removes the current highlight without highlighting a new node.</p><p><strong>setSearchActive</strong>: The user has clicked on the crosshair button in Sonar. This feature allows the user to click on an element in the client UI to cause flipper to highlight the corresponding node in the layout tree. A colored overlay should be shown over the whole screen until <code>setSearchActive</code> is called with <code>active: false</code>. While <code>setSearchActive</code> is true, clicking an element in the client UI should trigger a <code>select</code> call to the flipper desktop, with the path of ids from root to selected node e.g <code>select([&#x27;node1&#x27;, &#x27;node6&#x27;, &#x27;node65&#x27;])</code> to select a grandchild of <code>node1</code>.</p><p><strong>getSearchResults</strong>: Execute a query on all nodes in the tree, and return a subtree of the layout tree that contains all matching nodes and those on the path to the from the root. A parent that does not itself match the query but exists on the path to a node that does, should have attribute <code>isMatch: false</code> and only the matching nodes should have <code>isMatch: true</code>. Nodes not on the path from root to a match need not be included in the returned tree. Be careful not to confuse this method with the unrelated <code>setSearchActive</code>, which unfortunately shares a similar name.</p><p>Whenever a node or subtree changes it is expected that the client sends a <code>invalidate</code> command to the desktop app over the active connection. This will invalidate the cache of the subtree anchored by the node with the given id.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/facebook/flipper/blob/master/website/../docs/extending/supporting-layout.mdx" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/extending/establishing-a-connection"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Secure Communication</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/extending/arch"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Architecture »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#node" class="table-of-contents__link">Node</a></li><li><a href="#plugin-interface" class="table-of-contents__link">Plugin Interface</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Learn</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started/index">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/tutorial/intro">Plugin Creation Tutorial</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Plugins</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/features/index">Core Plugins</a></li><li class="footer__item"><a href="https://www.npmjs.com/search?q=keywords:flipper-plugin" target="_blank" rel="noopener noreferrer" class="footer__link-item">Community Plugins</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/flipper_fb" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li><li class="footer__item"><a href="https://github.com/facebook/flipper" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="text--center"><div class="margin-bottom--sm"><img class="footer__logo" alt="Flipper Mascot" src="/img/mascot.png"></div><div>Copyright © 2020 Facebook</div></div></div></footer></div>
<script src="/styles.24aaa79f.js"></script>
<script src="/runtime~main.f6c5a1a3.js"></script>
<script src="/main.9115e7e0.js"></script>
<script src="/1.0e39a8dc.js"></script>
<script src="/2.580ff063.js"></script>
<script src="/70.e3afd952.js"></script>
<script src="/20ac7829.82c23b79.js"></script>
<script src="/2527d735.0a52814b.js"></script>
</body>
</html>