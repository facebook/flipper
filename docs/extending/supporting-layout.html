<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Implementing Layout Inspection · Flipper</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="To enable the Flipper layout inspector on a new platform, just implement a client plugin with id `Inspector` which implements the following interface:"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Implementing Layout Inspection · Flipper"/><meta property="og:type" content="website"/><meta property="og:url" content="https://fbflipper.com//index.html"/><meta property="og:description" content="To enable the Flipper layout inspector on a new platform, just implement a client plugin with id `Inspector` which implements the following interface:"/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/img/icon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/code-blocks-buttons.js"></script><script type="text/javascript" src="/js/google-analytics.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/icon.png" alt="Flipper"/><h2 class="headerTitleWithLogo">Flipper</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/docs/features/index.html" target="_self">Features</a></li><li class=""><a href="/docs/getting-started/index.html" target="_self">Setup</a></li><li class="siteNavGroupActive"><a href="/docs/extending/index.html" target="_self">Extending</a></li><li class=""><a href="https://github.com/facebook/flipper" target="_self">GitHub</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Other Platforms</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Extending Flipper</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/extending/index.html">Clients and Plugins</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Tutorial</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/tutorial/intro.html">Intro</a></li><li class="navListItem"><a class="navItem" href="/docs/tutorial/ios.html">Building an iOS Plugin</a></li><li class="navListItem"><a class="navItem" href="/docs/tutorial/android.html">Building an Android Plugin</a></li><li class="navListItem"><a class="navItem" href="/docs/tutorial/react-native.html">Building a React Native Plugin</a></li><li class="navListItem"><a class="navItem" href="/docs/tutorial/js-setup.html">Building a desktop plugin</a></li><li class="navListItem"><a class="navItem" href="/docs/tutorial/js-table.html">Showing a table</a></li><li class="navListItem"><a class="navItem" href="/docs/tutorial/js-custom.html">Custom UI</a></li><li class="navListItem"><a class="navItem" href="/docs/tutorial/js-publishing.html">Publishing</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Plugin Development</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/extending/js-setup.html">JavaScript Plugin Definition</a></li><li class="navListItem"><a class="navItem" href="/docs/extending/js-plugin-api.html">JavaScript Plugin API</a></li><li class="navListItem"><a class="navItem" href="/docs/extending/create-table-plugin.html">Create Table Plugin</a></li><li class="navListItem"><a class="navItem" href="/docs/extending/ui-components.html">UI Components</a></li><li class="navListItem"><a class="navItem" href="/docs/extending/styling-components.html">Styling Components</a></li><li class="navListItem"><a class="navItem" href="/docs/extending/search-and-filter.html">Searching and Filtering</a></li><li class="navListItem"><a class="navItem" href="/docs/extending/create-plugin.html">Client Plugin API</a></li><li class="navListItem"><a class="navItem" href="/docs/extending/client-plugin-lifecycle.html">Client Plugin Lifecycle</a></li><li class="navListItem"><a class="navItem" href="/docs/extending/send-data.html">Providing Data to Plugins</a></li><li class="navListItem"><a class="navItem" href="/docs/extending/error-handling.html">Error Handling</a></li><li class="navListItem"><a class="navItem" href="/docs/extending/testing.html">Testing</a></li><li class="navListItem"><a class="navItem" href="/docs/extending/debugging.html">Debugging</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Other Platforms</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/extending/new-clients.html">Implementing a Flipper Client</a></li><li class="navListItem"><a class="navItem" href="/docs/extending/establishing-a-connection.html">Secure Communication</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/extending/supporting-layout.html">Implementing Layout Inspection</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Internals</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/extending/arch.html">Architecture</a></li><li class="navListItem"><a class="navItem" href="/docs/extending/layout-inspector.html">Extending Layout Inspector</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/facebook/flipper/blob/master/docs/extending/supporting-layout.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 id="__docusaurus" class="postHeaderTitle">Implementing Layout Inspection</h1></header><article><div><span><p>To enable the Flipper layout inspector on a new platform, just implement a client plugin with id <code>Inspector</code> which implements the following interface:</p>
<p>Note that we're using <a href="https://flow.org/en/docs/types/objects/">Flow</a> syntax to specify this JSON API.</p>
<h3><a class="anchor" aria-hidden="true" id="node"></a><a href="#node" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Node</h3>
<pre><code class="hljs">type NodeId = string;
<span class="hljs-built_in">
type </span>InspectorValue = {
  __type__: <span class="hljs-string">'auto'</span> | <span class="hljs-string">'text'</span> | <span class="hljs-string">'number'</span> | <span class="hljs-string">'boolean'</span> | <span class="hljs-string">'enum'</span> | <span class="hljs-string">'color'</span>,
  __mutable__: boolean,
  value: number | string | boolean,
};
<span class="hljs-built_in">
type </span>Node = {
  id: NodeId,
  name: string,
  data: ?{string: Object},
  children: Array&lt;NodeId&gt;,
  attributes: ?Array&lt;{name: string, value: string}&gt;,
  decoration: ?string,
};
</code></pre>
<p>Node is the core data type of the layout inspector. The Flipper desktop plugin visualizes a tree of nodes with associated data and attributes. Any UI or data model which can be modeled as a tree of nodes can be inspected using the layout inspector. Data associated with the nodes can also be edited.</p>
<p><code>id</code> is a stable globally unique node identifier.</p>
<p><code>name</code> is the user facing identifier for this node. It does not need to be unique. Typically the class name of the node is used as the node's name.</p>
<p><code>data</code> is a set of named JSON objects representing data associated with the node. This data will be rendered as immutable by default, to the user of the plugin but can be made mutable by wrapping any value in a InspectorValue with the <code>__mutable__</code> attribute set to true.</p>
<p>InspectorValue can also be used to change the parsed type of the value, such as parsing a number as a color to show the value in a color picker.</p>
<p><code>children</code> is a list of identifiers pointing to children of this node. This is a list of identifiers instead of a list of nodes to allow nodes to be lazily fetched and instantiated.</p>
<p><code>attributes</code> is a list of key:value pairs which are displayed alongside the name in the layout inspector.</p>
<p><code>decoration</code> is a string identifying the optional icon used to decorate a node in the layout inspector. Adding new decoration options requires adding an icon file to the Sonar desktop app. Currently componentkit and litho decorations are supported.</p>
<h3><a class="anchor" aria-hidden="true" id="plugin-interface"></a><a href="#plugin-interface" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Plugin Interface</h3>
<pre><code class="hljs">interface ClientLayoutPlugin {
  Node getRoot();
  GetNodesResponse getNodes({ids: Array&lt;NodeId&gt;});
  GetAllNodesResponse getAllNodes();
  void setData({id: NodeId, path: Array&lt;string&gt;, value: any});
  void setHighlighted({id: ?NodeId});
  void setSearchActive({active: boolean});
  GetSearchResultsResponse getSearchResults({query: string});
};
<span class="hljs-built_in">
interface </span>DesktopLayoutPlugin {
  void invalidate({id: NodeId});
  void select({path: Array&lt;NodeId&gt;});
};
<span class="hljs-built_in">
type </span>GetNodesResponse = {
  elements: Array&lt;Node&gt;
};<span class="hljs-built_in">
type </span>GetAllNodesResponse = {
  elements: Array&lt;Node&gt;,
  rootElement: NodeId
};<span class="hljs-built_in">
type </span>GetSearchResultsResponse = {
  results: ?SearchResultNode,
  query: string
};
<span class="hljs-built_in">
type </span>SearchResultNode = {
  id: NodeId,
  isMatch: boolean,
  element: Node,
  children: ?Array&lt;SearchResultNode&gt;
}<span class="hljs-built_in">
type </span>NodeId = string;
</code></pre>
<p><strong>getRoot</strong>: Return the root node of your hierarchy. This is the entry point of Flipper's traversal of your layout.</p>
<p><strong>getNodes</strong>: Map a set of NodeIds to their corresponding nodes. This call is used to among other things query the children of a node.</p>
<p><strong>getAllNodes</strong>: Similar to getNodes, this should return all nodes in the current layout tree. Ordinarily, nodes are requested lazily, however this exists for taking snapshots of the current state.</p>
<p><strong>setData</strong>: Set the data of an mutable data object returned as part of the data field of a node. The id parameter identifies the node, the path parameter is a index path into an object, e.g. <code>['bounds', 'left']</code> and the value parameter is a value of appropriate type to be used as an override.</p>
<p><strong>setHighlighted</strong>: Mark a node as highlighted. It is expected that implementations adds a colored overlay to the node identified by id on screen, so that as the user browses the layout tree in flipper, they can easily see on the the client display the nodes they are interacting with. Passing a null id parameter removes the current highlight without highlighting a new node.</p>
<p><strong>setSearchActive</strong>: The user has clicked on the crosshair button in Sonar. This feature allows the user to click on an element in the client UI to cause flipper to highlight the corresponding node in the layout tree. A colored overlay should be shown over the whole screen until <code>setSearchActive</code> is called with <code>active: false</code>. While <code>setSearchActive</code> is true, clicking an element in the client UI should trigger a <code>select</code> call to the flipper desktop, with the path of ids from root to selected node e.g <code>select(['node1', 'node6', 'node65'])</code> to select a grandchild of <code>node1</code>.</p>
<p><strong>getSearchResults</strong>: Execute a query on all nodes in the tree, and return a subtree of the layout tree that contains all matching nodes and those on the path to the from the root. A parent that does not itself match the query but exists on the path to a node that does, should have attribute <code>isMatch: false</code> and only the matching nodes should have <code>isMatch: true</code>. Nodes not on the path from root to a match need not be included in the returned tree. Be careful not to confuse this method with the unrelated <code>setSearchActive</code>, which unfortunately shares a similar name.</p>
<p>Whenever a node or subtree changes it is expected that the client sends a <code>invalidate</code> command to the desktop app over the active connection. This will invalidate the cache of the subtree anchored by the node with the given id.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/extending/establishing-a-connection.html"><span class="arrow-prev">← </span><span>Secure Communication</span></a><a class="docs-next button" href="/docs/extending/arch.html"><span>Architecture</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/mascot.png" alt="Flipper mascot" title="I&#x27;m a dolphin not a whale!" width="66"/></a><div><h5>Docs</h5><a href="/docs/getting-started.html">Getting Started</a><a href="/docs/extending/js-setup.html">Creating Plugins</a></div><div><h5>Plugins</h5><a href="/docs/features/logs-plugin.html">Log Viewer</a><a href="/docs/features/layout-plugin.html">Layout Inspector</a><a href="/docs/features/network-plugin.html">Network Inspector</a></div><div><h5>More</h5><a href="https://twitter.com/flipper_fb">Twitter</a><a href="https://github.com/facebook/flipper">GitHub</a><a class="github-button" href="https://github.com/facebook/flipper" data-icon="octicon-star" data-count-href="/facebook/flipper/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><a href="https://code.facebook.com/projects/" target="_blank" class="fbOpenSource"><img src="/img/oss_logo.png" alt="Facebook Open Source" width="170" height="45"/></a><section class="copyright">Copyright © 2020 Facebook</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '2df980e7ffc95c19552790f7cad32666',
                indexName: 'fbflipper',
                inputSelector: '#search_input_react',
                algoliaOptions: {"hitsPerPage":5}
              });
            </script></body></html>